(function e(t,i,a){function s(r,o){if(!i[r]){if(!t[r]){var l=typeof require=="function"&&require;if(!o&&l)return l(r,!0);if(n)return n(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var d=i[r]={exports:{}};t[r][0].call(d.exports,function(e){var i=t[r][1][e];return s(i?i:e)},d,d.exports,e,t,i,a)}return i[r].exports}var n=typeof require=="function"&&require;for(var r=0;r<a.length;r++)s(a[r]);return s})({"./src/Intermediate_PerelithKnight.ts":[function(e,t,i){var a=e("awayjs-core/lib/events/AssetEvent");var s=e("awayjs-core/lib/events/LoaderEvent");var n=e("awayjs-core/lib/geom/Vector3D");var r=e("awayjs-core/lib/library/AssetLibrary");var o=e("awayjs-core/lib/net/URLRequest");var l=e("awayjs-core/lib/ui/Keyboard");var h=e("awayjs-core/lib/utils/RequestAnimationFrame");var d=e("awayjs-display/lib/containers/View");var c=e("awayjs-display/lib/controllers/HoverController");var u=e("awayjs-display/lib/entities/DirectionalLight");var _=e("awayjs-display/lib/entities/Mesh");var w=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker");var p=e("awayjs-display/lib/prefabs/PrimitivePlanePrefab");var f=e("awayjs-renderergl/lib/animators/AnimationSetBase");var m=e("awayjs-renderergl/lib/animators/VertexAnimator");var y=e("awayjs-renderergl/lib/DefaultRenderer");var g=e("awayjs-methodmaterials/lib/MethodMaterial");var v=e("awayjs-methodmaterials/lib/pool/MethodRendererPool");var b=e("awayjs-methodmaterials/lib/methods/ShadowFilteredMethod");var k=e("awayjs-parsers/lib/MD2Parser");var M=function(){function e(){var e=this;this._meshInitialised=false;this._animationSetInitialised=false;this._sceneInitialised=false;this._pKnightTextures=new Array("assets/pknight1.png","assets/pknight2.png","assets/pknight3.png","assets/pknight4.png");this._pKnightMaterials=new Array;this._time=0;this._move=false;this._lookAtPosition=new n;this._view=new d(new y(v));this._view.camera.projection.far=5e3;this._cameraController=new c(this._view.camera,null,45,20,2e3,5);this._light=new u(-.5,-1,-1);this._light.ambient=.4;this._lightPicker=new w([this._light]);this._view.scene.addChild(this._light);r.addEventListener(a.ASSET_COMPLETE,function(t){return e.onAssetComplete(t)});r.addEventListener(s.RESOURCE_COMPLETE,function(t){return e.onResourceComplete(t)});r.load(new o("assets/pknight1.png"));r.load(new o("assets/pknight2.png"));r.load(new o("assets/pknight3.png"));r.load(new o("assets/pknight4.png"));r.load(new o("assets/floor_diffuse.jpg"));r.load(new o("assets/pknight.md2"),null,null,new k);this._shadowMapMethod=new b(this._light);this._shadowMapMethod.epsilon=.2;this._floorMaterial=new g;this._floorMaterial.lightPicker=this._lightPicker;this._floorMaterial.specular=0;this._floorMaterial.ambient=1;this._floorMaterial.shadowMethod=this._shadowMapMethod;this._floorMaterial.repeat=true;for(var t=0;t<this._pKnightTextures.length;t++){var i=new g;i.lightPicker=this._lightPicker;i.gloss=30;i.specular=1;i.ambient=1;i.shadowMethod=this._shadowMapMethod;this._pKnightMaterials.push(i)}this._floor=new p(5e3,5e3).getNewObject();this._floor.material=this._floorMaterial;this._floor.geometry.scaleUV(5,5);this._view.scene.addChild(this._floor);window.onresize=function(t){return e.onResize(t)};document.onmousedown=function(t){return e.onMouseDown(t)};document.onmouseup=function(t){return e.onMouseUp(t)};document.onmousemove=function(t){return e.onMouseMove(t)};document.onmousewheel=function(t){return e.onMouseWheel(t)};document.onkeydown=function(t){return e.onKeyDown(t)};document.onkeyup=function(t){return e.onKeyUp(t)};this.onResize();this._timer=new h(this.onEnterFrame,this);this._timer.start()}e.prototype.onEnterFrame=function(e){this._time+=e;if(this._keyUp)this._lookAtPosition.x-=10;if(this._keyDown)this._lookAtPosition.x+=10;if(this._keyLeft)this._lookAtPosition.z-=10;if(this._keyRight)this._lookAtPosition.z+=10;this._cameraController.lookAtPosition=this._lookAtPosition;this._view.render()};e.prototype.onAssetComplete=function(e){var t=e.asset;switch(t.assetType){case _.assetType:this._mesh=e.asset;this._mesh.y=120;this._mesh.transform.scale=new n(5,5,5);this._meshInitialised=true;break;case f.assetType:this._animationSet=e.asset;this._animationSetInitialised=true;break}if(this._animationSetInitialised&&this._meshInitialised&&!this._sceneInitialised){this._sceneInitialised=true;var i=20;var a=20;var s=0;for(var r=0;r<i;r++){for(var o=0;o<a;o++){var l=this._mesh.clone();l.x=(r-(i-1)/2)*5e3/i;l.z=(o-(a-1)/2)*5e3/a;l.castsShadows=true;l.material=this._pKnightMaterials[Math.floor(Math.random()*this._pKnightMaterials.length)];this._view.scene.addChild(l);var h=new m(this._animationSet);h.play(this._animationSet.animationNames[Math.floor(Math.random()*this._animationSet.animationNames.length)],null,Math.random()*1e3);l.animator=h;s++}}}};e.prototype.onResourceComplete=function(e){var t=e.assets;var i=t.length;for(var a=0;a<i;a++){var s=t[a];console.log(s.name,e.url);switch(e.url){case"assets/floor_diffuse.jpg":this._floorMaterial.texture=s;break;case"assets/pknight1.png":case"assets/pknight2.png":case"assets/pknight3.png":case"assets/pknight4.png":this._pKnightMaterials[this._pKnightTextures.indexOf(e.url)].texture=s;break;case"assets/pknight.md2":break}}};e.prototype.onKeyDown=function(e){switch(e.keyCode){case l.UP:case l.W:case l.Z:this._keyUp=true;break;case l.DOWN:case l.S:this._keyDown=true;break;case l.LEFT:case l.A:case l.Q:this._keyLeft=true;break;case l.RIGHT:case l.D:this._keyRight=true;break}};e.prototype.onKeyUp=function(e){switch(e.keyCode){case l.UP:case l.W:case l.Z:this._keyUp=false;break;case l.DOWN:case l.S:this._keyDown=false;break;case l.LEFT:case l.A:case l.Q:this._keyLeft=false;break;case l.RIGHT:case l.D:this._keyRight=false;break}};e.prototype.onMouseDown=function(e){this._lastPanAngle=this._cameraController.panAngle;this._lastTiltAngle=this._cameraController.tiltAngle;this._lastMouseX=e.clientX;this._lastMouseY=e.clientY;this._move=true};e.prototype.onMouseUp=function(e){this._move=false};e.prototype.onMouseMove=function(e){if(this._move){this._cameraController.panAngle=.3*(e.clientX-this._lastMouseX)+this._lastPanAngle;this._cameraController.tiltAngle=.3*(e.clientY-this._lastMouseY)+this._lastTiltAngle}};e.prototype.onMouseWheel=function(e){this._cameraController.distance-=e.wheelDelta;if(this._cameraController.distance<100)this._cameraController.distance=100;else if(this._cameraController.distance>2e3)this._cameraController.distance=2e3};e.prototype.onResize=function(e){if(e===void 0){e=null}this._view.y=0;this._view.x=0;this._view.width=window.innerWidth;this._view.height=window.innerHeight};return e}();window.onload=function(){new M}},{"awayjs-core/lib/events/AssetEvent":undefined,"awayjs-core/lib/events/LoaderEvent":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/library/AssetLibrary":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/ui/Keyboard":undefined,"awayjs-core/lib/utils/RequestAnimationFrame":undefined,"awayjs-display/lib/containers/View":undefined,"awayjs-display/lib/controllers/HoverController":undefined,"awayjs-display/lib/entities/DirectionalLight":undefined,"awayjs-display/lib/entities/Mesh":undefined,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":undefined,"awayjs-display/lib/prefabs/PrimitivePlanePrefab":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":undefined,"awayjs-methodmaterials/lib/pool/MethodRendererPool":undefined,"awayjs-parsers/lib/MD2Parser":undefined,"awayjs-renderergl/lib/DefaultRenderer":undefined,"awayjs-renderergl/lib/animators/AnimationSetBase":undefined,"awayjs-renderergl/lib/animators/VertexAnimator":undefined}]},{},["./src/Intermediate_PerelithKnight.ts"]);

//# sourceMappingURL=Intermediate_PerelithKnight.js.map